<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.ResMapper">

    <insert id="insertReservation" parameterType="com.example.test1.model.reservation.ReservationList">
        
        <selectKey keyProperty="resNum" resultType="Long" order="BEFORE">
            SELECT RES_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        
        INSERT INTO ADMIN.RESERVATION (
            RES_NUM, USER_ID, PACKNAME, PRICE, AREANUM, THEMNUM, DESCRIPT, START_DATE, END_DATE
        )
        VALUES (
            #{resNum}, #{userId, jdbcType=VARCHAR}, #{packName}, #{price}, #{areaNum}, #{themNum}, #{descript, jdbcType=VARCHAR}, #{startDate}, #{endDate}
        )
    </insert>

    <insert id="insertPoi" parameterType="com.example.test1.model.reservation.Poi">
        INSERT INTO ADMIN.POI (
            POI_ID, CONTENT_ID, TYPE_ID, RES_NUM, RESERV_DATE, RATING, CONTENT, PLACE_NAME
        ) 
        VALUES (
            POI_SEQ.NEXTVAL, 
            #{contentId}, 
            #{typeId}, 
            #{resNum}, 
            #{reservDate}, 
            #{rating, jdbcType=INTEGER},  
            #{content, jdbcType=CLOB},
            #{placeName, jdbcType=VARCHAR} )
    </insert>

    <select id="selectPoisByResNum" parameterType="Long" resultType="com.example.test1.model.reservation.Poi">
        SELECT
            T.POI_ID, T.CONTENT_ID, T.TYPE_ID, T.RES_NUM, T.RESERV_DATE, T.RATING, T.CONTENT,
            T.PLACE_NAME AS placeName, A.MAPY AS mapY,
            A.MAPX AS mapX
        FROM ADMIN.POI T
        LEFT JOIN ADMIN.ATTR A
            ON T.CONTENT_ID = A.CONTENT_ID
        WHERE T.RES_NUM = #{resNum}
        ORDER BY T.RESERV_DATE ASC, T.POI_ID ASC
    </select>

    <select id="selectPoiDetailsByApi" parameterType="java.lang.String" resultType="com.example.test1.model.reservation.Poi">
        </select>

</mapper>